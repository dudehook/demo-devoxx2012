<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Nevernote : never forget your notes</title>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
    <script src="js/jquery-1.8.2.min.js"></script>
    <script src="js/mustache.js"></script>
    <script src="js/underscore.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <style type="text/css">
        .done-true {
            text-decoration: line-through;        
        }
    </style>
</head>
<body>
  <header class="container">
    <div class="page-header">
      <div class="row">
        <div class="span8">
          <img />
        </div>
        <div class="span4">
          <p>
            <h1>Nevernote</h1>
            <img />
          </p>
          <p>
            <h1><small>Never forget your notes</small></h1>
          </p>
        </div>
      </div>
  </header>  
  <section class="container">
    <div class=row>
      <div id="showFastNewNote">
        <form class="span4 offset4">
          <div class="control-group">
            <label class="control-label" for="fastNoteText">Add fast note: </label>
            <div class="controls">
              <div class="input-append">
                <input id="fastNoteTitle" type="text"> 
                <input id="fastNoteContent" type="text">            
                <button type="button" id="submitFastNoteButton" class="btn"><i class="icon-ok"></i></button>
                <button type="button" id="showNewNoteButton" class="btn"><i class="icon-plus"></i></button>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div id="showNewNote">
        <form class="span4 offset4">
          <div class="control-group">
            <label class="control-label" for="fastNoteText">Add note: </label>
            <div class="controls">
              <div class="input-append">
                <input id="fastNoteText" type="text">
                <button type="button" class="btn"><i class="icon-ok"></i></button>
                <button type="button" id="hideNewNoteButton" class="btn"><i class="icon-plus"></i></button>
              </div>
            </div>
          </div>
        </form>
      </div>    
      <div class="span1 offset3">
        <a href="settings.html" id="showSettingsButton" class="btn btn-large btn-primary"><i class="icon-wrench icon-white"></i></a>
      </div>
    </div>
  </section>  
  <section class="container">
    <div>
        <script type="text/html" id="taskline_tmpl">
            <tr>
                <td class="{{doneclass}}">{{title}}</t>
                <td class="{{doneclass}}">{{content}}</t>
                <td>
                    <button data-id="{{id}}" class="btn {{btndoneclass}} donetask"><i class="{{doneicon}} icon-white"></i></button>
                    &nbsp;
                    <button data-id="{{id}}" class="btn btn-primary edittask"><i class="icon-edit icon-white"></i></button>
                    &nbsp;
                    <button data-id="{{id}}" class="btn btn-danger deletetask"><i class="icon-trash icon-white"></i></button>
                </td>                 
            </tr>
        </script>
        <table class="table table-striped table-condensed">
            <thead>
                <tr>
                    <th width="40%">Title</th>
                    <th width="40%">Content</th>
                    <th width="20%">Actions</th>
                </tr>
            </thead>
            <tbody id="tasks">
            </tbody>
        </table>
    </div>
  </section>   
  <footer class="container">
    <p class="pull-right">
      Made with <a>Weld-OSGi framework</a> for <a>Devoxx 2012</a> presentation by <a>Mathieu Ancelin</a> & <a>Matthieu Clochard</a>
    </p>
  </footer>
  
  <script>
    function render(templateId, view) {
        return Mustache.render( $(templateId).html(), view )
    }
    $(document).ready(function() {
        var showNewNote = function(e) {
            e.preventDefault()
            $("#showFastNewNote").hide();
            $("#showPluginsConfiguration").hide();
            $("#showNewNote").show();
        }
        
        var hideNewNote = function(e) {
            e.preventDefault()
            $("#showNewNote").hide();
            $("#showPluginsConfiguration").hide();
            $("#showFastNewNote").show();
        }
        var addFastNote = function(event) {
            event.preventDefault();
            var title = $("#fastNoteTitle").val()
            var content = $("#fastNoteContent").val()
            $.ajax({url:'/notes', type: 'put', data:{title: title, content: content}, complete:function(data) {
                $("#fastNoteTitle").val("")
                $("#fastNoteContent").val("")
                updateTasks()
            }})
        }
        
        function updateTasks() {
            $('#tasks').empty()
            $.get('/notes', function(data) {
                data.note.forEach(function(elem, array, idx) {
                    var doneclass = ''
                    var btndoneclass = 'btn-inverse'
                    var doneicon = 'icon-ok'
                    if (elem.done == "true") {
                        doneclass = 'done-true'
                        btndoneclass = 'btn-success'
                        doneicon = 'icon-ban-circle'
                    }
                    $('#tasks').append(render("#taskline_tmpl", 
                        {
                            title: elem.title, 
                            content: elem.content, 
                            id: elem.id, 
                            doneclass: doneclass,
                            btndoneclass: btndoneclass,
                            doneicon: doneicon
                        })
                    )
                })
            })
        }

        $("#submitFastNoteButton").click(addFastNote)
        $("#showNewNote").hide()
        updateTasks()
        $(".donetask").live('click', function(e) {
          console.log("done")
          e.preventDefault()
          var id = $(this).data('id')
          $.post('/notes/done/' + id, function(data) {
              updateTasks()
          })        }) 
        $(".edittask").live('click', function(e) {
          console.log("edit")
          e.preventDefault()
          var id = $(this).data('id')
        }) 
        $(".deletetask").live('click', function(e) {
          console.log("delete")
          e.preventDefault()
          var id = $(this).data('id')
          $.ajax({url:'/notes/' + id, type:'delete', complete: function(data) {
               updateTasks()
          }})
        }) 
    });    
  </script>
</body>
</html>