<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Nevernote : never forget your notes</title>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <script src="js/jquery-1.8.2.min.js"></script>
    <script src="js/mustache.js"></script>
    <script src="js/underscore.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <style type="text/css">
        .done-true {
            text-decoration: line-through;
        }

        html, body {
            background-color: #fff;
        }

        body {
            padding-top: 60px;
        }

        .container > footer p {
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container">
    <header class="navbar navbar-fixed-top navbar-inverse">
        <div class="navbar-inner">
            <div class="container">
                <a href="/static/" class="brand">Nevernote</a>
                <ul class="nav">
                    <li><a href="edit.html"><i class="icon-plus icon-white"></i> Add a new note</a></li>
                    <li><a href="settings.html"><i class="icon-wrench icon-white"></i> Plugin settings</a></li>
                    <li><a href="#">&nbsp;&nbsp;&nbsp;Fast note &nbsp;</a></li>
                    <li>
                        <form class="navbar-form form-inline pull-right">
                            <input id="fastNoteTitle" type="text" class="span2" placeholder="Title">

                            <div class="input-append">
                                <input id="fastNoteContent" type="text" class="span2" placeholder="Content">
                                <button type="button" id="submitFastNoteButton" class="btn"><i class="icon-ok"></i>
                                </button>
                            </div>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <section class="container">
        <div>
            <script type="text/html" id="pluginline_tmpl">
                <tr class="{{stateClass}}">
                    <td>{{pluginName}}</td>
                    <td>
                        <button data-id="{{pluginId}}BtnState" class="btn {{btnStateClass}} btn-state"><i class="{{btnStateIcon}} icon-white"></i></button>
                        &nbsp;
                        <button data-id="{{pluginId}}BtnTrash" class="btn btn-danger btn-trash"><i class="icon-trash icon-white"></i>
                        </button>
                    </td>
                </tr>
            </script>
            <script type="text/html" id="pluginfooter_tmpl">
                <tr class="info">
                    <td>Add a plugin</td>
                    <td>
                        <button type="button" class="btn btn-primary"><i class="icon-folder-open icon-white"></i></button>
                    </td>
                </tr>
            </script>
            <table class="table table-striped table-condensed">
                <thead>
                <tr>
                    <th width="75%">Plugin</th>
                    <th width="25%">Actions</th>
                </tr>
                </thead>
                <tbody id="plugins">
                </tbody>
            </table>
        </div>
    </section>
</div>
<footer class="navbar navbar-fixed-bottom" style="text-align: center">
      Made with <a>Weld-OSGi framework</a> for <a>Devoxx 2012</a> presentation by <a>Mathieu Ancelin</a> & <a>Matthieu
      Clochard</a>
</footer>
<script>
    function render(templateId, view) {
        return Mustache.render($(templateId).html(), view)
    }
    $(document).ready(function () {
        function appendPlugin(elem) {
            var stateClass = 'error'
            var btnStateClass = 'btn-success'
            var btnStateIcon = 'icon-play'
            if (elem.active == true) {
                stateClass = 'success'
                btnStateClass = 'btn-danger'
                btnStateIcon = 'icon-stop'
            }
            $('#plugins').append(render("#pluginline_tmpl",
                    {
                        pluginId:elem.id,
                        pluginName:elem.name,
                        stateClass:stateClass,
                        btnStateClass:btnStateClass,
                        btnStateIcon:btnStateIcon
                    }))
        }
        function updatePlugins() {
            $('#plugins').empty()
            $.get('/plugins/installed', function (data) {
                if (data != null && data != null && data != undefined) {
                    data.forEach(function (plugin, array, idx) {
                        var elem = {id: plugin.id, name: plugin.name,active:false}
                        appendPlugin(elem)
                    })
                }
                $.get('/plugins/active', function (data) {
                    if (data != null && data != null && data != undefined) {
                        data.forEach(function (plugin, array, idx) {
                            console.log(plugin)
                            var elem = {id: plugin.id, name: plugin.name,active:true}
                            appendPlugin(elem)
                        })
                    }
                    $('#plugins').append(render("#pluginfooter_tmpl",{}))
                })
            })
        }
        updatePlugins()
        $(".btn-state").live('click', function (e) {
            e.preventDefault()
            var id = $(this).data('id').substr(0,$(this).data('id').length - 8)
            console.log(id)
            if($(this).hasClass('btn-danger')) {
              $.get('/plugins/' + id + '/stop', function (data) {
                updatePlugins()
              })
            }
            else {
              $.get('/plugins/' + id + '/start', function (data) {
                updatePlugins()
              })
            }
        })
        $(".btn-trash").live('click', function (e) {
            e.preventDefault()
            var id = $(this).data('id').substr(0,$(this).data('id').length - 8)
            console.log(id)
            $.get('/plugins/' + id + '/remove', function (data) {
              updatePlugins()
            })
        })
    });
</script>
</body>
</html>